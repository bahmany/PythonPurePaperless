<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd" >


<html lang="en">
  <head>
    <title>dlg_uploader.html</title>
	
    <meta http-equiv="keywords" content="keyword1,keyword2,keyword3">
    <meta http-equiv="description" content="this is my page">
    
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <!--<link rel="stylesheet" type="text/css" href="./styles.css">-->
<script src="scripts/main_script.js" type="text/javascript"></script>
    <script type="text/javascript" src="scripts/jquery.min.js"></script>
  </head>
  
  <body>
    
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
<script src="https://maps.googleapis.com/maps/api/js?v=3.exp&sensor=false"></script>

    
                     <table style="width:100%;">
		      <tbody>
			<tr>
			  <td style="vertical-align: top; width: 320px;">
			    
			    
			    
<div id="div_uploader" style="width: 320px;border-color: #325027;border-radius: 10px 10px 10px 10px;border-style: solid;border-width: 1px;box-shadow: 0 0 5px #888888;font-family: BYekan;font-size: 15px;margin-bottom: 10px;margin-top: 15px;padding: 10px;">
<a href="#" onclick="" style="padding-left: 6px; padding-right: 6px;">مشاهده مسیر حرکت  </a> | <a href="#" onclick="" style="padding-left: 6px; padding-right: 6px;">آپلود نمودن فایل ها</a>
			  
		<div id="div_upload">
		</div>
			  <ul>
			    <span style="font-size: large; font-weight: bold; color: red;">
			    نکات مهم
			    </span>
			    
			  <li>از انتقال فایل با نام فارسی بپرهیزید</li>
			  <li>لطفا از اینکه دستگاه کنترل نگهبانان مربوط به کدام نگهبان است اطمینان حاصل نمایید</li>
			  <li>پس از انتقال فایل دستگاه ها دیگر قادر به ویرایش نخواهید بود</li>
			  <li>در هر بار انتقال فایل فقط میتوانید فایل های مربوط به یک نگهبان را منتقل کنید</li>
			  <li>ممکن از انتقال فایل کمی طولانی باشد ، خواهشمندیم تا پایان مرحله ی انتقال صبر کنید</li>
			  <li>این سیستم فقط فایل های مربوط به دستگاه های نگهبانی را میخواند ، لذا از ارسال سایر فایل ها خودداری نمایید</li>
			  </ul>

		
			    
		 <div id="div_fileuploader" style="width: 300px; border-color: #325027;border-radius: 10px 10px 10px 10px;border-style: solid;border-width: 1px;box-shadow: 0 0 5px #888888;font-family: BNazaninRegular;font-size: 15px;margin-bottom: 10px;margin-top: 15px;padding: 10px;">                            
<form enctype="multipart/form-data" action="py_gps_save_file.py" method="post" id="filesender" name="filesender">
<hr>
<p>مرحله اول : انتخاب نام نگهبان مورد نظر : </p>
<select name="sometext" id="sometext" size="5">

</select>
<hr>
  <p>مرحله دوم : انتخاب فایل های مربوط به نگهبان مورد نظر :  </p>
<p>File1: <input type="file" name="file1" id="_file1">  </p>
<p>File2: <input type="file" name="file2" id="_file2"></p>
<p>File3: <input type="file" name="file3" id="_file3"></p>
<p>File4: <input type="file" name="file4" id="_file4"></p>
<p>File5: <input type="file" name="file5" id="_file5"></p>
<p>File6: <input type="file" name="file6" id="_file6"></p>
<p>File7: <input type="file" name="file7" id="_file7"></p>
<p>File8: <input type="file" name="file8" id="_file8"></p>
<input type="hidden" name="uid" id="uid">
<hr>
<p>مرحله سوم : ارسال فایل به سرور : </p>
<p><input type="submit" value="ارسال به سرور" id="btn_sendform"/></p><p>
<p><a href="#"  id="sndit" onclick="SendIt()">ارسال به جی کوئری</a></p>
 <hr>
	<table>
    
	  <tbody>
<tr>
	    <td>
	      


	    </td>
	    
	    


	</tr>
	  </tbody>
	</table>

 
 



</div>	    


	</div>

</td>
			  <td >
	      <div>
		<table>
		  <tbody>
		    <tr>
		      <td>
			<p>مرحله اول : انتخاب نام نگهبان مورد نظر : </p>
<select multiple="true" name="sometext2" id="sometext2" size="5">

</select>
<hr>
  		<p>مرحله دوم : تاریخ روز مورد نظر را وارد نمایید </p>
		<input id="obj_Text14" type="text" special="nn_da_0">
		  		      <p>مرحله سوم : محاسبه ی تعداد موقعیت های ثبت شده</p>
		      <a href="#" onclick="get_positions_count()">محاسبه ی موقعیت های ارسال شده</a>
		      <p>مرحله چهارم : انتخاب تعداد موقعیت دلخواه جهت مشاهده</p>
		      <input id="obj_count" type="text" style="width: 100px;" value="0"> نقطه از <span id="span_count"></span> نقطه 
		      <a href="#" onclick="get_pos()">دریافت موقعیت ها</a>
		      <p>مرحله پنجم : مشاهده مسیر حرکت</p>
		      <div id="pos_place">
			
			
		      </div>
		      </td>
		      <td>

		      </td>
		    </tr>
		    
		  </tbody>
		  
		</table>
		
	      </div>


			    
			 
			 
			 
			 
			  </td>
			  <td style="vertical-align: top">
			    	      			<div id="map-canvas" style="width:600px; height: 400px;">
			  
			</div>
			    
			  </td>
			</tr>
			
		      </tbody>
		      
		     </table>   
</form>
     <script type="application/x-javascript">
      
      
      var filecontent=[];
      
      
      
      function SendIt() {
	//ReadFileAllBrowsers("file1",CallBackFunction);
	
	
	ReadFileAllBrowsers(document.getElementById("_file1"), CallBackFunction);
	ReadFileAllBrowsers(document.getElementById("_file2"), CallBackFunction);
	ReadFileAllBrowsers(document.getElementById("_file3"), CallBackFunction);
	ReadFileAllBrowsers(document.getElementById("_file4"), CallBackFunction);
	ReadFileAllBrowsers(document.getElementById("_file5"), CallBackFunction);
	ReadFileAllBrowsers(document.getElementById("_file6"), CallBackFunction);
	ReadFileAllBrowsers(document.getElementById("_file7"), CallBackFunction);
	ReadFileAllBrowsers(document.getElementById("_file8"), CallBackFunction);
	
	_data="uid=1"
for (var i=0;i<filecontent.length;i++) {
  _data=_data+"&"+"filecontent"+(i+1).toString()+"="+escape(filecontent[i]);
}

	$.post("py_gps_save_file.py",  _data,function(dta){
	  
	  });
      }
      
      
      
      var CallBackFunction = function(content)
{
     filecontent.push(content);
}


//Tested in Mozilla Firefox browser, Chrome
function ReadFileAllBrowsers(FileElement, CallBackFunction)
{
try
{
    var file = FileElement.files[0];
    var contents_ = "";

     if (file) {
        var reader = new FileReader();
        reader.readAsText(file, "UTF-8");
        reader.onload = function(evt)
        {
            CallBackFunction(evt.target.result);
        }
        reader.onerror = function (evt) {
            alert("Error reading file");
        }
    }
}
catch (Exception)
 {
    var fall_back =  ieReadFile(FileElement.value);
    if(fall_back != false)
    {
        CallBackFunction(fall_back);
    }
 }
}

///Reading files with Internet Explorer
function ieReadFile(filename)
{
 try
 {
    var fso  = new ActiveXObject("Scripting.FileSystemObject");
    var fh = fso.OpenTextFile(filename, 1);
    var contents = fh.ReadAll();
    fh.Close();
    return contents;
 }
 catch (Exception)
  {
    alert(Exception);
    return false;
  }
 }
 
      
      
          (function($) { 
    $.fn.serializeAll = function() {
        var rselectTextarea = /^(?:select|textarea)/i;
        var rinput = /^(?:color|date|datetime|datetime-local|email|file|hidden|month|number|password|range|search|tel|text|time|url|week)$/i;
        var rCRLF = /\r?\n/g;

        var arr = this.map(function(){
            return this.elements ? jQuery.makeArray( this.elements ) : this;
        })
        .filter(function(){
            return this.name && !this.disabled &&
                ( this.checked || rselectTextarea.test( this.nodeName ) ||
                    rinput.test( this.type ) );
        })
        .map(function( i, elem ){
            var val = jQuery( this ).val();

            return val == null ?
                null :
                jQuery.isArray( val ) ?
                    jQuery.map( val, function( val, i ){
                        return { name: elem.name, value: val.replace( rCRLF, "\r\n" ) };
                    }) :
                    { name: elem.name, value: val.replace( rCRLF, "\r\n" ) };
        }).get();

        return $.param(arr);
    }
})(jQuery);
      
      
      
      
      $.post("py_user_manager.py", "negahban=136543-564654-32184-546534", function(data) {
       var s = []
       s = data.split("vfdd")
       var myForm = document.filesender; //Form Name
       var mySel = myForm.sometext; // Listbox Name 
       for (var i = 0; i < s.length; i++) {
	 myOption = document.createElement("Option");
	 myOption.text = s[i].split("=")[1];
	 myOption.value = s[i].split("=")[0];
	 mySel.add(myOption);

       }
     });
     $.post("py_user_manager.py", "negahban=136543-564654-32184-546534", function(data) {
       var s = []
       s = data.split("vfdd")
       var myForm = document.filesender; //Form Name
       var mySel = myForm.sometext2; // Listbox Name 
       for (var i = 0; i < s.length; i++) {
	 myOption = document.createElement("Option");
	 myOption.text = s[i].split("=")[1];
	 myOption.value = s[i].split("=")[0];
	 mySel.add(myOption);

       }
     });


     function get_positions_count() {
       var allSchools = [];
       var s = document.getElementById("sometext2");
       for (var i = 0; i < s.options.length; i++) {
	 if (s.options[i].selected == true) {
	   var schoolid = s.options[i].value;
	   allSchools.push(schoolid);
	 }
       }
       var str="";
       for (var i=0;i<allSchools.length;i++) {
	if (i==0) {
	  str=allSchools[i]
	} else
	{
	  str=str+","+allSchools[i]
	  
	}
       }
       str = "sel="+str+"&dt="+document.getElementById("obj_Text14").value;
       $.post("py_gps.py",str,function(data)
	      {
		document.getElementById("span_count").innerHTML=data
		});
       
     }
     
     
     function get_pos() {
      var count_no = parseInt(document.getElementById("span_count").innerHTML);
      var number_rows_wanted =  parseInt(document.getElementById("obj_count").value);
      var total= parseInt(count_no/number_rows_wanted);
      
      
      //------------------------
             var allSchools = [];
       var s = document.getElementById("sometext2");
       for (var i = 0; i < s.options.length; i++) {
	 if (s.options[i].selected == true) {
	   var schoolid = s.options[i].value;
	   allSchools.push(schoolid);
	 }
       }
       var str="";
       for (var i=0;i<allSchools.length;i++) {
	if (i==0) {
	  str=allSchools[i]
	} else
	{
	  str=str+","+allSchools[i]
	  
	}
       }
       str = "sel2="+str+"&dt2="+document.getElementById("obj_Text14").value+"&totalrows="+total.toString();
       //------------------------------------------------------------
             $.post("py_gps.py",str,function(data)
	      {
		document.getElementById("pos_place").innerHTML = "";
		var html = "";
		var pos=[];
		pos = data.split("cz");
	
	var gpath=[];

		for (var i=0;i<pos.length;i++) {
		  var posa = pos[i].split("!");
		  html = html + " <div >تاریخ :       "+posa[3]+"</div><hr>"

		  gpath.push(new google.maps.LatLng(parseFloat(posa[1]), parseFloat(posa[0])));
  
		}
		
		  var flightPath = new google.maps.Polyline({
    path: gpath,
    geodesic: true,
    strokeColor: '#FF0000',
    strokeOpacity: 1.0,
    strokeWeight: 2
  });
		  flightPath.setMap(map);


		
		document.getElementById("pos_place").innerHTML = html;
		
		
	      });
      
     }

     
     
     
     
     
     


     
     
     
     function send_file_jquery()
     {
      
      

      
      
      /*
      var filename = $("#file1").val();
              $.ajax({
            type: "POST",
            url: "py_gps_save_file.py",
            enctype: 'multipart/form-data',
            data: {
                file1: filename
            },
            success: function () {
                alert("Data Uploaded: ");
            }
        });
      */
      
     }
     
     
     
     
     
     
     
  //   $("#obj_Text14").mask("1399/99/99");
 var map;
function initialize() {
  var mapOptions = {
    zoom:16,
    center: new google.maps.LatLng(32.256984,51.061747),
    mapTypeId: google.maps.MapTypeId.SATELLITE
  };
  map = new google.maps.Map(document.getElementById('map-canvas'),
      mapOptions);
}

google.maps.event.addDomListener(window, 'load', initialize);

    </script>
  </body>
 

  
</html>

